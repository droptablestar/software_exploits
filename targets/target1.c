#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int correct_passwd(char *passwd)
{
	int a, b, c;

	if (strlen(passwd) < 3)
		return 0;

	a = passwd[0];
	b = passwd[1];
	c = passwd[2];

	if (a + b != 27)
		return 0;
	if (b + c != 52)
		return 0;
	if (c + a != 14)
		return 0;

	return 1;
}

void printfile()
{
	char c;
	FILE *fp = fopen("/home/poorvictim/secret.txt","r");

	if (fp == NULL)
		return;
	
	c = fgetc(fp);
	while(c != EOF){
		putc(c, stdout);
		c = fgetc(fp);
	}
	
	fclose(fp);
}

int main(int argc, char ** argv)
{
	int decision;
	char passwd[16];
	
	if (argc < 2) {
		printf("usage: %s password\n", argv[0]);
		return 0;
	}

	decision = correct_passwd(argv[1]);
	strcpy(passwd, argv[1]);

	if (decision){
		printf("Access granted to the document with passwd %s!\n", passwd);
		printfile();
	}
	else
		printf("Access denied.\n");
	return 0;
}

